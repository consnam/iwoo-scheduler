<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì´ìš°í•™êµ 2026 1í•™ê¸° ê³ 3 ì‹œê°„í‘œ í”Œë˜ë„ˆ</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
  :root {
    --primary: #4F46E5;
    --primary-light: #818CF8;
    --primary-bg: #EEF2FF;
    --success: #059669;
    --success-bg: #D1FAE5;
    --warning: #D97706;
    --warning-bg: #FEF3C7;
    --danger: #DC2626;
    --danger-bg: #FEE2E2;
    --gray-50: #F9FAFB;
    --gray-100: #F3F4F6;
    --gray-200: #E5E7EB;
    --gray-300: #D1D5DB;
    --gray-500: #6B7280;
    --gray-700: #374151;
    --gray-900: #111827;
    --sport: #F59E0B;
    --sport-bg: #FFFBEB;
    --free: #94A3B8;
    --free-bg: #F1F5F9;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    color: var(--gray-900);
  }

  .app-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }

  header {
    text-align: center;
    padding: 30px 20px 20px;
    color: white;
  }

  header h1 {
    font-size: 28px;
    font-weight: 800;
    margin-bottom: 6px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }

  header p {
    font-size: 15px;
    opacity: 0.9;
  }

  .card {
    background: white;
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 20px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.08);
  }

  .card-title {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .card-title .icon {
    font-size: 22px;
  }

  /* Step indicator */
  .steps {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 24px;
  }

  .step {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    background: rgba(255,255,255,0.2);
    color: rgba(255,255,255,0.7);
    transition: all 0.3s;
  }

  .step.active {
    background: white;
    color: var(--primary);
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  }

  .step.done {
    background: rgba(255,255,255,0.4);
    color: white;
  }

  .step-num {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 700;
    background: rgba(255,255,255,0.3);
  }

  .step.active .step-num {
    background: var(--primary);
    color: white;
  }

  .step.done .step-num {
    background: var(--success);
    color: white;
  }

  /* Course selection */
  .set-group {
    margin-bottom: 16px;
    border: 1px solid var(--gray-200);
    border-radius: 12px;
    overflow: hidden;
  }

  .set-header {
    padding: 10px 16px;
    background: var(--gray-50);
    font-size: 13px;
    font-weight: 700;
    color: var(--gray-500);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .set-header .time-info {
    font-weight: 400;
    font-size: 12px;
  }

  .course-options {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 12px 16px;
  }

  .course-chip {
    padding: 8px 14px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    border: 2px solid var(--gray-200);
    background: white;
    transition: all 0.2s;
    user-select: none;
  }

  .course-chip:hover {
    border-color: var(--primary-light);
    background: var(--primary-bg);
  }

  .course-chip.selected {
    border-color: var(--primary);
    background: var(--primary-bg);
    color: var(--primary);
    font-weight: 700;
  }

  .course-chip.disabled {
    opacity: 0.35;
    cursor: not-allowed;
    border-color: var(--gray-200);
    background: var(--gray-100);
  }

  .course-chip.blocked {
    opacity: 0.3;
    cursor: not-allowed;
    border-color: var(--danger);
    background: var(--danger-bg);
    text-decoration: line-through;
  }

  .course-chip.blocked .blocked-reason {
    display: inline;
    font-size: 10px;
    margin-left: 4px;
    color: var(--danger);
    font-weight: 700;
  }

  .course-chip:not(.blocked) .blocked-reason {
    display: none;
  }

  .course-chip .credit-badge {
    display: inline-block;
    margin-left: 4px;
    font-size: 11px;
    font-weight: 700;
    color: var(--gray-500);
  }

  .course-chip.selected .credit-badge {
    color: var(--primary);
  }

  /* Credit counter */
  .credit-bar {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px 20px;
    background: var(--gray-50);
    border-radius: 12px;
    margin-bottom: 16px;
  }

  .credit-number {
    font-size: 36px;
    font-weight: 800;
    color: var(--primary);
    line-height: 1;
  }

  .credit-label {
    font-size: 13px;
    color: var(--gray-500);
  }

  .credit-progress {
    flex: 1;
    height: 10px;
    background: var(--gray-200);
    border-radius: 5px;
    overflow: hidden;
  }

  .credit-progress-fill {
    height: 100%;
    border-radius: 5px;
    transition: width 0.4s ease, background 0.3s;
  }

  .credit-status {
    font-size: 13px;
    font-weight: 600;
    white-space: nowrap;
  }

  /* Generate button */
  .generate-btn {
    width: 100%;
    padding: 16px;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    background: linear-gradient(135deg, #4F46E5, #7C3AED);
    color: white;
    transition: all 0.3s;
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
  }

  .generate-btn:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4);
  }

  .generate-btn:disabled {
    background: var(--gray-300);
    cursor: not-allowed;
    box-shadow: none;
  }

  /* Timetable */
  .timetable-container {
    overflow-x: auto;
  }

  .timetable {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
    min-width: 600px;
  }

  .timetable th {
    padding: 10px 8px;
    background: var(--primary);
    color: white;
    font-weight: 700;
    text-align: center;
    font-size: 14px;
  }

  .timetable th:first-child {
    width: 60px;
    border-radius: 8px 0 0 0;
  }

  .timetable th:last-child {
    border-radius: 0 8px 0 0;
  }

  .timetable td {
    padding: 10px 6px;
    text-align: center;
    border: 1px solid var(--gray-200);
    font-weight: 500;
    vertical-align: middle;
    line-height: 1.4;
  }

  .timetable .period-cell {
    background: var(--gray-50);
    font-weight: 700;
    color: var(--gray-700);
    font-size: 12px;
    width: 60px;
  }

  .timetable .lunch-row td {
    background: var(--warning-bg);
    font-size: 14px;
    padding: 6px;
  }

  .cell-fixed {
    background: var(--gray-50);
    color: var(--gray-500);
  }

  .cell-selected {
    background: var(--primary-bg);
    color: var(--primary);
    font-weight: 700;
  }

  .cell-sport {
    background: var(--sport-bg);
    color: var(--sport);
    font-weight: 700;
  }

  .cell-free {
    background: var(--free-bg);
    color: var(--free);
    font-style: italic;
  }

  .cell-special {
    background: #FDF4FF;
    color: #9333EA;
    font-weight: 600;
  }

  /* Result navigation */
  .result-nav {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    margin-bottom: 16px;
  }

  .result-nav button {
    padding: 8px 16px;
    border: 2px solid var(--primary);
    border-radius: 8px;
    background: white;
    color: var(--primary);
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .result-nav button:hover {
    background: var(--primary-bg);
  }

  .result-nav button:disabled {
    border-color: var(--gray-300);
    color: var(--gray-300);
    cursor: not-allowed;
  }

  .result-count {
    font-size: 15px;
    font-weight: 700;
    color: var(--gray-700);
  }

  /* Result detail */
  .result-detail {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 16px;
  }

  .result-tag {
    padding: 5px 12px;
    border-radius: 15px;
    font-size: 12px;
    font-weight: 600;
  }

  .tag-course {
    background: var(--primary-bg);
    color: var(--primary);
  }

  .tag-free {
    background: var(--free-bg);
    color: var(--free);
  }

  .tag-credit {
    background: var(--success-bg);
    color: var(--success);
  }

  /* Alert */
  .alert {
    padding: 14px 18px;
    border-radius: 10px;
    font-size: 14px;
    margin-bottom: 16px;
    display: flex;
    align-items: flex-start;
    gap: 10px;
  }

  .alert-warning {
    background: var(--warning-bg);
    color: #92400E;
  }

  .alert-danger {
    background: var(--danger-bg);
    color: #991B1B;
  }

  .alert-success {
    background: var(--success-bg);
    color: #065F46;
  }

  .alert-icon { font-size: 18px; flex-shrink: 0; }

  /* Info box */
  .info-box {
    padding: 14px 18px;
    background: var(--gray-50);
    border-radius: 10px;
    font-size: 13px;
    color: var(--gray-500);
    line-height: 1.6;
    margin-top: 16px;
  }

  /* Responsive */
  @media (max-width: 640px) {
    .app-container { padding: 8px; }
    header { padding: 20px 12px 16px; }
    header h1 { font-size: 20px; }
    header p { font-size: 13px; }
    .card { padding: 14px; }
    .card-title { font-size: 16px; }
    .course-options { gap: 6px; }
    .course-chip { padding: 6px 10px; font-size: 12px; }
    .credit-bar { flex-wrap: wrap; gap: 10px; padding: 12px 14px; }
    .credit-number { font-size: 28px; }
    .steps { flex-wrap: wrap; gap: 6px; }
    .step { padding: 6px 10px; font-size: 12px; }

    .timetable { min-width: unset; width: 100%; font-size: 11px; }
    .timetable th { padding: 8px 2px; font-size: 12px; }
    .timetable td { padding: 8px 2px; font-size: 11px; word-break: keep-all; }
    .timetable .period-cell { width: 36px; font-size: 10px; }
    .timetable-container { overflow-x: hidden; }

    .result-detail { gap: 6px; }
    .result-tag { padding: 4px 8px; font-size: 11px; }
    .save-btn { font-size: 13px; padding: 10px 16px; }
    .info-box { font-size: 12px; }
    .header-actions { flex-wrap: wrap; gap: 8px; }
  }

  /* Reset button */
  .reset-btn {
    padding: 8px 16px;
    border: 2px solid var(--danger);
    border-radius: 8px;
    background: white;
    color: var(--danger);
    font-weight: 600;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .reset-btn:hover { background: var(--danger-bg); }

  .header-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .save-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    background: linear-gradient(135deg, #059669, #10B981);
    color: white;
    transition: all 0.3s;
    box-shadow: 0 2px 8px rgba(5,150,105,0.3);
  }
  .save-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(5,150,105,0.4); }
  .save-btn:disabled { background: var(--gray-300); cursor: wait; box-shadow: none; }
</style>
</head>
<body>

<div class="app-container" id="app">
  <header>
    <h1>ğŸ“š ì´ìš°í•™êµ ê³ 3 ì‹œê°„í‘œ í”Œë˜ë„ˆ</h1>
    <p>2026ë…„ 1í•™ê¸° Â· ì›í•˜ëŠ” ê³¼ëª©ì„ ì„ íƒí•˜ë©´ ì‹œê°„í‘œë¥¼ ë§Œë“¤ì–´ ë“œë ¤ìš”</p>
    <div class="steps" style="margin-top:16px">
      <div class="step active" id="step1"><span class="step-num">1</span> ê³¼ëª© ì„ íƒ</div>
      <div class="step" id="step2"><span class="step-num">2</span> ì‹œê°„í‘œ ìƒì„±</div>
      <div class="step" id="step3"><span class="step-num">3</span> ê²°ê³¼ í™•ì¸</div>
    </div>
  </header>

  <!-- Step 1: Course Selection -->
  <div id="selection-panel">
    <div class="card">
      <div class="header-actions">
        <div class="card-title"><span class="icon">ğŸ¯</span> ë“£ê³  ì‹¶ì€ ê³¼ëª©ì„ ì„ íƒí•˜ì„¸ìš”</div>
        <button class="reset-btn" onclick="resetAll()">ì´ˆê¸°í™”</button>
      </div>

      <div class="credit-bar">
        <div>
          <div class="credit-number" id="credit-count">0</div>
          <div class="credit-label">ì„ íƒ í•™ì </div>
        </div>
        <div style="flex:1">
          <div style="display:flex;justify-content:space-between;margin-bottom:4px">
            <span class="credit-label">ìµœì†Œ 28í•™ì </span>
            <span class="credit-status" id="credit-status">ê³¼ëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”</span>
          </div>
          <div class="credit-progress">
            <div class="credit-progress-fill" id="credit-fill" style="width:0%;background:var(--gray-300)"></div>
          </div>
        </div>
      </div>

      <div id="set-containers"></div>

      <div id="alert-area"></div>

      <button class="generate-btn" id="generate-btn" disabled onclick="generateTimetables()">
        ì‹œê°„í‘œ ë§Œë“¤ê¸°
      </button>

      <div class="info-box">
        ğŸ’¡ <strong>ì‚¬ìš©ë²•:</strong> ê° ì‹œê°„ëŒ€(ì„¸íŠ¸)ì—ì„œ ì›í•˜ëŠ” ê³¼ëª©ì„ í•˜ë‚˜ì”© í´ë¦­í•˜ì„¸ìš”.
        ê°™ì€ ì‹œê°„ëŒ€ì˜ ê³¼ëª©ë¼ë¦¬ëŠ” í•˜ë‚˜ë§Œ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”.
        ê°™ì€ ê³¼ëª©(ì˜ˆ: í™•ë¥ ê³¼í†µê³„A/B/C)ì€ í•˜ë‚˜ë§Œ ì„ íƒ ê°€ëŠ¥í•˜ë©°, í•˜ë‚˜ë¥¼ ì„ íƒí•˜ë©´ ë‹¤ë¥¸ ì„¸íŠ¸ì˜ ê°™ì€ ê³¼ëª©ì€ ìë™ìœ¼ë¡œ <strong style="color:var(--danger)">ì·¨ì†Œì„ </strong> ì²˜ë¦¬ë©ë‹ˆë‹¤.
        ì„ íƒí•œ ê³¼ëª©ì„ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ì·¨ì†Œë©ë‹ˆë‹¤.
        í•™ì ì´ 28 ì´ìƒì´ë©´ ì‹œê°„í‘œë¥¼ ìƒì„±í•  ìˆ˜ ìˆì–´ìš”.
      </div>
    </div>
  </div>

  <!-- Step 3: Results -->
  <div id="result-panel" style="display:none">
    <div class="card">
      <div class="header-actions">
        <div class="card-title"><span class="icon">ğŸ“‹</span> ì‹œê°„í‘œ ê²°ê³¼</div>
        <button class="reset-btn" onclick="backToSelection()">â† ê³¼ëª© ë‹¤ì‹œ ì„ íƒ</button>
      </div>

      <div id="result-alert-area"></div>
      <div class="result-nav" id="result-nav"></div>
      <div id="result-tags"></div>
      <div class="timetable-container" id="timetable-display"></div>
      <div style="margin-top:16px; text-align:center">
        <button class="save-btn" id="save-btn" onclick="saveAsImage()">ğŸ“· ì‹œê°„í‘œ ì´ë¯¸ì§€ë¡œ ì €ì¥</button>
      </div>
      <div class="info-box" style="margin-top:16px">
        ğŸ’¡ ìŠ¤í¬ì¸ ìƒí™œ(1í•™ì )ì€ í•œ ì‹œê°„ëŒ€ë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ ë‚˜ë¨¸ì§€ ì‹œê°„ëŒ€ì— ê³µê°•ì´ ìƒê¸¸ ìˆ˜ ìˆì–´ìš”.
        ê³µê°• ì‹œê°„ ììŠµ ê°€ëŠ¥ ì—¬ë¶€ëŠ” í•™êµì— í™•ì¸í•´ ì£¼ì„¸ìš”.
      </div>
    </div>
  </div>
</div>

<script>
// ============================================================
// DATA: ì´ìš°í•™êµ 2026 1í•™ê¸° ê³ 3 ì‹œê°„í‘œ ì„¸íŠ¸ êµ¬ì¡°
// ============================================================

const SETS = [
  {
    id: "Set1",
    label: "ì„¸íŠ¸ 1",
    slots: ["í™”1-2", "ëª©1-2"],
    courses: [
      { name: "í™•ë¥ ê³¼í†µê³„A", displayName: "í™•ë¥ ê³¼í†µê³„A", shortName: "í™•ë¥ ê³¼í†µê³„", tinyName: "í™•í†µ", group: "í™•ë¥ ê³¼í†µê³„", credits: 4, slots: ["í™”1-2", "ëª©1-2"] },
      { name: "ë…ì„œD", displayName: "ë…ì„œD", shortName: "ë…ì„œ", tinyName: "ë…ì„œ", group: "ë…ì„œ", credits: 4, slots: ["í™”1-2", "ëª©1-2"] },
      { name: "ë¯¸ìˆ ì´ë¡ ", displayName: "ë¯¸ìˆ ì´ë¡ ", shortName: "ë¯¸ìˆ ì´ë¡ ", tinyName: "ë¯¸ìˆ ì´ë¡ ", group: null, credits: 4, slots: ["í™”1-2", "ëª©1-2"] },
      { name: "ìŠ¤í¬ì¸ ìƒí™œC", displayName: "ìŠ¤í¬ì¸ ìƒí™œC", shortName: "ìŠ¤í¬ì¸ ìƒí™œ", tinyName: "ìŠ¤í¬ì¸ ", group: "ìŠ¤í¬ì¸ ìƒí™œ", credits: 1, slots: ["í™”1-2"] },
    ]
  },
  {
    id: "Set2",
    label: "ì„¸íŠ¸ 2",
    slots: ["í™”3-4", "ìˆ˜1-2"],
    courses: [
      { name: "ë…ì„œA", displayName: "ë…ì„œA", shortName: "ë…ì„œ", tinyName: "ë…ì„œ", group: "ë…ì„œ", credits: 4, slots: ["í™”3-4", "ìˆ˜1-2"] },
      { name: "ì˜ì–´2B", displayName: "ì˜ì–´â…¡B", shortName: "ì˜ì–´â…¡", tinyName: "ì˜ì–´â…¡", group: "ì˜ì–´â…¡", credits: 4, slots: ["í™”3-4", "ìˆ˜1-2"] },
      { name: "ì‹¬í™”ì˜ì–´ë…í•´B", displayName: "ì‹¬í™”ì˜ì–´ë…í•´B", shortName: "ì‹¬í™”ì˜ì–´ë…í•´", tinyName: "ì‹¬ì˜ë…", group: "ì‹¬í™”ì˜ì–´ë…í•´", credits: 4, slots: ["í™”3-4", "ìˆ˜1-2"] },
      { name: "ê³¼í•™ê³¼ì œì—°êµ¬", displayName: "ê³¼í•™ê³¼ì œì—°êµ¬", shortName: "ê³¼í•™ê³¼ì œì—°êµ¬", tinyName: "ê³¼ê³¼ì—°", group: null, credits: 4, slots: ["í™”3-4", "ìˆ˜1-2"] },
      { name: "ìŠ¤í¬ì¸ ìƒí™œB", displayName: "ìŠ¤í¬ì¸ ìƒí™œB", shortName: "ìŠ¤í¬ì¸ ìƒí™œ", tinyName: "ìŠ¤í¬ì¸ ", group: "ìŠ¤í¬ì¸ ìƒí™œ", credits: 1, slots: ["ìˆ˜1-2"] },
    ]
  },
  {
    id: "Set3",
    label: "ì„¸íŠ¸ 3",
    slots: ["í™”5-6", "ê¸ˆ5-6"],
    courses: [
      { name: "ì„¸ê³„ì‚¬", displayName: "ì„¸ê³„ì‚¬", shortName: "ì„¸ê³„ì‚¬", tinyName: "ì„¸ê³„ì‚¬", group: null, credits: 4, slots: ["í™”5-6", "ê¸ˆ5-6"] },
      { name: "ìƒí™œê³¼ìœ¤ë¦¬", displayName: "ìƒí™œê³¼ìœ¤ë¦¬", shortName: "ìƒí™œê³¼ìœ¤ë¦¬", tinyName: "ìƒìœ¤", group: null, credits: 4, slots: ["í™”5-6", "ê¸ˆ5-6"] },
      { name: "ìƒëª…ê³¼í•™2", displayName: "ìƒëª…ê³¼í•™â…¡", shortName: "ìƒëª…ê³¼í•™â…¡", tinyName: "ìƒëª…â…¡", group: null, credits: 4, slots: ["í™”5-6", "ê¸ˆ5-6"] },
      { name: "ì² í•™", displayName: "ì² í•™", shortName: "ì² í•™", tinyName: "ì² í•™", group: null, credits: 4, slots: ["í™”5-6", "ê¸ˆ5-6"] },
      { name: "í”„ë¡œê·¸ë˜ë°", displayName: "í”„ë¡œê·¸ë˜ë°", shortName: "í”„ë¡œê·¸ë˜ë°", tinyName: "í”„ë°", group: null, credits: 4, slots: ["í™”5-6", "ê¸ˆ5-6"] },
    ]
  },
  {
    id: "Set4",
    label: "ì„¸íŠ¸ 4",
    slots: ["í™”7-8", "ëª©3-4"],
    courses: [
      { name: "ìŠ¤í¬ì¸ ìƒí™œA", displayName: "ìŠ¤í¬ì¸ ìƒí™œA", shortName: "ìŠ¤í¬ì¸ ìƒí™œ", tinyName: "ìŠ¤í¬ì¸ ", group: "ìŠ¤í¬ì¸ ìƒí™œ", credits: 1, slots: ["í™”7-8"] },
      { name: "ë…ì„œB", displayName: "ë…ì„œB", shortName: "ë…ì„œ", tinyName: "ë…ì„œ", group: "ë…ì„œ", credits: 4, slots: ["í™”7-8", "ëª©3-4"] },
      { name: "í™•ë¥ ê³¼í†µê³„B", displayName: "í™•ë¥ ê³¼í†µê³„B", shortName: "í™•ë¥ ê³¼í†µê³„", tinyName: "í™•í†µ", group: "í™•ë¥ ê³¼í†µê³„", credits: 4, slots: ["í™”7-8", "ëª©3-4"] },
      { name: "ì„¸ê³„ë¬¸ì œì™€ë¯¸ë˜ì‚¬íšŒ", displayName: "ì„¸ê³„ë¬¸ì œì™€ë¯¸ë˜ì‚¬íšŒ", shortName: "ì„¸ê³„ë¬¸ì œì™€ë¯¸ë˜ì‚¬íšŒ", tinyName: "ì„¸ë¯¸ì‚¬", group: null, credits: 4, slots: ["í™”7-8", "ëª©3-4"] },
    ]
  },
  {
    id: "Set5",
    label: "ì„¸íŠ¸ 5",
    slots: ["ìˆ˜3-4", "ê¸ˆ3-4"],
    courses: [
      { name: "ì˜ì–´2A", displayName: "ì˜ì–´â…¡A", shortName: "ì˜ì–´â…¡", tinyName: "ì˜ì–´â…¡", group: "ì˜ì–´â…¡", credits: 4, slots: ["ìˆ˜3-4", "ê¸ˆ3-4"] },
      { name: "ì‹¬í™”ì˜ì–´ë…í•´A", displayName: "ì‹¬í™”ì˜ì–´ë…í•´A", shortName: "ì‹¬í™”ì˜ì–´ë…í•´", tinyName: "ì‹¬ì˜ë…", group: "ì‹¬í™”ì˜ì–´ë…í•´", credits: 4, slots: ["ìˆ˜3-4", "ê¸ˆ3-4"] },
      { name: "ë…ì„œC", displayName: "ë…ì„œC", shortName: "ë…ì„œ", tinyName: "ë…ì„œ", group: "ë…ì„œ", credits: 4, slots: ["ìˆ˜3-4", "ê¸ˆ3-4"] },
      { name: "ë¯¸ì ë¶„", displayName: "ë¯¸ì ë¶„", shortName: "ë¯¸ì ë¶„", tinyName: "ë¯¸ì ë¶„", group: null, credits: 4, slots: ["ìˆ˜3-4", "ê¸ˆ3-4"] },
      { name: "ìŠ¤í¬ì¸ ìƒí™œD", displayName: "ìŠ¤í¬ì¸ ìƒí™œD", shortName: "ìŠ¤í¬ì¸ ìƒí™œ", tinyName: "ìŠ¤í¬ì¸ ", group: "ìŠ¤í¬ì¸ ìƒí™œ", credits: 1, slots: ["ê¸ˆ3-4"] },
    ]
  },
  {
    id: "Set6",
    label: "ì„¸íŠ¸ 6",
    slots: ["ì›”3-4", "ëª©5-6"],
    courses: [
      { name: "ì‚¬íšŒë¬¸í™”", displayName: "ì‚¬íšŒë¬¸í™”", shortName: "ì‚¬íšŒë¬¸í™”", tinyName: "ì‚¬ë¬¸", group: null, credits: 4, slots: ["ì›”3-4", "ëª©5-6"] },
      { name: "ì² í•™ì›ì „ì½ê¸°", displayName: "ì² í•™ì›ì „ì½ê¸°", shortName: "ì² í•™ì›ì „ì½ê¸°", tinyName: "ì² ì›ì½", group: null, credits: 4, slots: ["ì›”3-4", "ëª©5-6"] },
      { name: "ì˜í™”ì‚¬", displayName: "ì˜í™”ì‚¬", shortName: "ì˜í™”ì‚¬", tinyName: "ì˜í™”ì‚¬", group: null, credits: 4, slots: ["ì›”3-4", "ëª©5-6"] },
      { name: "DBí”„ë¡œê·¸ë˜ë°", displayName: "DBí”„ë¡œê·¸ë˜ë°", shortName: "DBí”„ë¡œê·¸ë˜ë°", tinyName: "DBí”„ë°", group: null, credits: 4, slots: ["ì›”3-4", "ëª©5-6"] },
      { name: "ìˆ˜í•™ê³¼ì œíƒêµ¬", displayName: "ìˆ˜í•™ê³¼ì œíƒêµ¬", shortName: "ìˆ˜í•™ê³¼ì œíƒêµ¬", tinyName: "ìˆ˜ê³¼íƒ", group: null, credits: 4, slots: ["ì›”3-4", "ëª©5-6"] },
    ]
  },
  {
    id: "Set7",
    label: "ì„¸íŠ¸ 7",
    slots: ["ì›”5-6", "ëª©7-8"],
    courses: [
      { name: "ì‚¬íšŒë¬¸ì œíƒêµ¬", displayName: "ì‚¬íšŒë¬¸ì œíƒêµ¬", shortName: "ì‚¬íšŒë¬¸ì œíƒêµ¬", tinyName: "ì‚¬ë¬¸íƒ", group: null, credits: 4, slots: ["ì›”5-6", "ëª©7-8"] },
      { name: "ë¹„êµë¬¸í™”", displayName: "ë¹„êµë¬¸í™”", shortName: "ë¹„êµë¬¸í™”", tinyName: "ë¹„êµë¬¸í™”", group: null, credits: 4, slots: ["ì›”5-6", "ëª©7-8"] },
      { name: "í™”í•™2", displayName: "í™”í•™â…¡", shortName: "í™”í•™â…¡", tinyName: "í™”í•™â…¡", group: null, credits: 4, slots: ["ì›”5-6", "ëª©7-8"] },
      { name: "í™•ë¥ ê³¼í†µê³„C", displayName: "í™•ë¥ ê³¼í†µê³„C", shortName: "í™•ë¥ ê³¼í†µê³„", tinyName: "í™•í†µ", group: "í™•ë¥ ê³¼í†µê³„", credits: 4, slots: ["ì›”5-6", "ëª©7-8"] },
    ]
  },
  {
    id: "Set8",
    label: "ì„¸íŠ¸ 8",
    slots: ["ì›”7-8"],
    courses: [
      { name: "ì¼ë³¸ì–´1", displayName: "ì¼ë³¸ì–´â… ", shortName: "ì¼ë³¸ì–´â… ", tinyName: "ì¼ë³¸ì–´", group: null, credits: 4, slots: ["ì›”7-8"] },
      { name: "ì¤‘êµ­ì–´1", displayName: "ì¤‘êµ­ì–´â… ", shortName: "ì¤‘êµ­ì–´â… ", tinyName: "ì¤‘êµ­ì–´", group: null, credits: 4, slots: ["ì›”7-8"] },
      { name: "í”„ë‘ìŠ¤ì–´1", displayName: "í”„ë‘ìŠ¤ì–´â… ", shortName: "í”„ë‘ìŠ¤ì–´â… ", tinyName: "í”„ë‘ìŠ¤ì–´", group: null, credits: 4, slots: ["ì›”7-8"] },
      { name: "ë…ì¼ì–´1", displayName: "ë…ì¼ì–´â… ", shortName: "ë…ì¼ì–´â… ", tinyName: "ë…ì¼ì–´", group: null, credits: 4, slots: ["ì›”7-8"] },
      { name: "í•œë¬¸1", displayName: "í•œë¬¸â… ", shortName: "í•œë¬¸â… ", tinyName: "í•œë¬¸", group: null, credits: 4, slots: ["ì›”7-8"] },
      { name: "ì‹¬í™”ì˜ì–´2", displayName: "ì‹¬í™”ì˜ì–´â…¡", shortName: "ì‹¬í™”ì˜ì–´â…¡", tinyName: "ì‹¬ì˜â…¡", group: null, credits: 4, slots: ["ì›”7-8"] },
    ]
  },
  {
    id: "Set9",
    label: "ì„¸íŠ¸ 9",
    slots: ["ê¸ˆ1-2"],
    courses: [
      { name: "ë¦¬ë”ì‰½", displayName: "ë¦¬ë”ì‰½", shortName: "ë¦¬ë”ì‰½", tinyName: "ë¦¬ë”ì‰½", group: null, credits: 4, slots: ["ê¸ˆ1-2"] },
      { name: "ë¬¼ë¦¬í•™2", displayName: "ë¬¼ë¦¬í•™â…¡", shortName: "ë¬¼ë¦¬í•™â…¡", tinyName: "ë¬¼ë¦¬â…¡", group: null, credits: 4, slots: ["ê¸ˆ1-2"] },
    ]
  },
];

const FIXED_SCHEDULE = {
  "ì›”1-2": { name: "í•™ê¸‰ìì¹˜", tinyName: "í•™ê¸‰ìì¹˜", type: "fixed" },
  "ìˆ˜5-6": { name: "ë‹¤ë§Œday", tinyName: "ë‹¤ë§Œday", type: "special" },
  "ìˆ˜7-8": { name: "ë‹¤ë§Œday", tinyName: "ë‹¤ë§Œday", type: "special" },
  "ìˆ˜9-10": { name: "ì—°ê·¹ê³¼ì‚¶/ì˜í™”ì™€ì‚¶", tinyName: "ì—°ê·¹/ì˜í™”", type: "special" },
  "ê¸ˆ7-8": { name: "ë™ì•„ë¦¬", tinyName: "ë™ì•„ë¦¬", type: "fixed" },
};

function isMobile() {
  return window.innerWidth <= 640;
}

function getCellName(cell) {
  if (isMobile() && cell.tinyName) return cell.tinyName;
  return cell.name;
}

const DAYS = ["ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ"];
const PERIODS = ["1-2", "3-4", "5-6", "7-8", "9-10"];
const MIN_CREDITS = 28;

// ============================================================
// STATE
// ============================================================

let selections = {}; // setId -> courseName
let results = [];
let currentResult = 0;

// ============================================================
// RENDERING
// ============================================================

function renderSetContainers() {
  const container = document.getElementById('set-containers');
  container.innerHTML = SETS.map(set => {
    const slotsDisplay = set.slots.map(s => {
      const day = s.charAt(0);
      const dayName = {ì›”:'ì›”',í™”:'í™”',ìˆ˜:'ìˆ˜',ëª©:'ëª©',ê¸ˆ:'ê¸ˆ'}[day];
      return dayName + ' ' + s.substring(1);
    }).join(', ');

    return `
      <div class="set-group" id="group-${set.id}">
        <div class="set-header">
          <span>${set.label}</span>
          <span class="time-info">${slotsDisplay}êµì‹œ</span>
        </div>
        <div class="course-options">
          ${set.courses.map(c => `
            <div class="course-chip"
                 data-set="${set.id}"
                 data-course="${c.name}"
                 data-group="${c.group || ''}"
                 onclick="toggleCourse('${set.id}', '${c.name}')">
              ${c.displayName}
              <span class="credit-badge">${c.credits}í•™ì </span>
              <span class="blocked-reason"></span>
            </div>
          `).join('')}
        </div>
      </div>
    `;
  }).join('');
}

// Build a map of which groups are already selected (group -> { setId, courseName })
function getSelectedGroups() {
  const groupMap = {};
  for (const [setId, courseName] of Object.entries(selections)) {
    const set = SETS.find(s => s.id === setId);
    const course = set.courses.find(c => c.name === courseName);
    if (course && course.group) {
      groupMap[course.group] = { setId, displayName: course.displayName };
    }
  }
  return groupMap;
}

function updateUI() {
  const selectedGroups = getSelectedGroups();

  // Update chips
  SETS.forEach(set => {
    const selected = selections[set.id];
    set.courses.forEach(course => {
      const chip = document.querySelector(`[data-set="${set.id}"][data-course="${course.name}"]`);
      if (!chip) return;
      chip.classList.remove('selected', 'disabled', 'blocked');
      const blockedReason = chip.querySelector('.blocked-reason');
      if (blockedReason) blockedReason.textContent = '';

      // Check if this course's group is already selected in ANOTHER set
      const isBlockedByGroup = course.group
        && selectedGroups[course.group]
        && selectedGroups[course.group].setId !== set.id;

      if (selected === course.name) {
        chip.classList.add('selected');
      } else if (isBlockedByGroup) {
        chip.classList.add('blocked');
      } else if (selected) {
        chip.classList.add('disabled');
      }
    });
  });

  // Update credits
  const totalCredits = calcTotalCredits();
  const creditCount = document.getElementById('credit-count');
  const creditFill = document.getElementById('credit-fill');
  const creditStatus = document.getElementById('credit-status');

  creditCount.textContent = totalCredits;
  const pct = Math.min(100, (totalCredits / MIN_CREDITS) * 100);
  creditFill.style.width = pct + '%';

  if (totalCredits >= MIN_CREDITS) {
    creditFill.style.background = 'var(--success)';
    creditStatus.textContent = `âœ… ${MIN_CREDITS}í•™ì  ì´ìƒ ì¶©ì¡±!`;
    creditStatus.style.color = 'var(--success)';
  } else {
    creditFill.style.background = 'var(--primary)';
    creditStatus.textContent = `${MIN_CREDITS - totalCredits}í•™ì  ë” í•„ìš”`;
    creditStatus.style.color = 'var(--warning)';
  }

  // Update generate button
  const btn = document.getElementById('generate-btn');
  const selectedCount = Object.keys(selections).length;
  if (selectedCount === 0) {
    btn.disabled = true;
    btn.textContent = 'ê³¼ëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”';
  } else if (totalCredits < MIN_CREDITS) {
    btn.disabled = true;
    btn.textContent = `í•™ì ì´ ë¶€ì¡±í•´ìš” (${totalCredits}/${MIN_CREDITS})`;
  } else {
    btn.disabled = false;
    btn.textContent = `ğŸ“ ì‹œê°„í‘œ ë§Œë“¤ê¸° (${totalCredits}í•™ì )`;
  }

  // Alerts
  updateAlerts();
}

function updateAlerts() {
  const area = document.getElementById('alert-area');
  const alerts = [];

  // Check if sport is selected
  const hasSport = Object.values(selections).some(name => name.startsWith('ìŠ¤í¬ì¸ ìƒí™œ'));
  if (hasSport) {
    alerts.push({
      type: 'warning',
      icon: 'âš¡',
      text: 'ìŠ¤í¬ì¸ ìƒí™œ(1í•™ì )ì€ ì„¸íŠ¸ì˜ ì¼ë¶€ ì‹œê°„ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤. ë‚˜ë¨¸ì§€ ì‹œê°„ëŒ€ì— ê³µê°•ì´ ë°œìƒí•´ìš”.'
    });
  }

  area.innerHTML = alerts.map(a => `
    <div class="alert alert-${a.type}">
      <span class="alert-icon">${a.icon}</span>
      <span>${a.text}</span>
    </div>
  `).join('');
}

// ============================================================
// LOGIC
// ============================================================

function toggleCourse(setId, courseName) {
  // If already selected, toggle off
  if (selections[setId] === courseName) {
    delete selections[setId];
    updateUI();
    return;
  }

  // Check if this course's group is already selected in another set
  const set = SETS.find(s => s.id === setId);
  const course = set.courses.find(c => c.name === courseName);
  if (course && course.group) {
    const selectedGroups = getSelectedGroups();
    if (selectedGroups[course.group] && selectedGroups[course.group].setId !== setId) {
      // Blocked! Don't allow selection
      return;
    }
  }

  selections[setId] = courseName;
  updateUI();
}

function calcTotalCredits() {
  let total = 0;
  for (const [setId, courseName] of Object.entries(selections)) {
    const set = SETS.find(s => s.id === setId);
    const course = set.courses.find(c => c.name === courseName);
    if (course) total += course.credits;
  }
  return total;
}

function resetAll() {
  selections = {};
  updateUI();
}

// ============================================================
// TIMETABLE GENERATION
// ============================================================

function generateTimetables() {
  // Build timetable from selections
  const schedule = {};

  // Fixed items
  for (const [slot, info] of Object.entries(FIXED_SCHEDULE)) {
    schedule[slot] = { ...info };
  }

  // Selected courses
  const freeSlots = [];
  for (const [setId, courseName] of Object.entries(selections)) {
    const set = SETS.find(s => s.id === setId);
    const course = set.courses.find(c => c.name === courseName);

    // Place course in its slots
    course.slots.forEach(slot => {
      schedule[slot] = {
        name: course.shortName,
        tinyName: course.tinyName,
        fullName: course.displayName,
        type: course.credits === 1 ? 'sport' : 'selected',
        credits: course.credits,
      };
    });

    // If 1-credit course, find missing slots
    if (course.credits === 1) {
      set.slots.forEach(slot => {
        if (!course.slots.includes(slot)) {
          schedule[slot] = { name: 'ê³µê°• (ììŠµ)', tinyName: 'ê³µê°•', type: 'free' };
          freeSlots.push(slot);
        }
      });
    }
  }

  results = [{ schedule, freeSlots, credits: calcTotalCredits(), selections: { ...selections } }];
  currentResult = 0;

  showResults();
}

function showResults() {
  document.getElementById('selection-panel').style.display = 'none';
  document.getElementById('result-panel').style.display = 'block';

  // Update steps
  document.getElementById('step1').className = 'step done';
  document.getElementById('step2').className = 'step done';
  document.getElementById('step3').className = 'step active';

  renderResult(0);
}

function backToSelection() {
  document.getElementById('selection-panel').style.display = 'block';
  document.getElementById('result-panel').style.display = 'none';

  document.getElementById('step1').className = 'step active';
  document.getElementById('step2').className = 'step';
  document.getElementById('step3').className = 'step';
}

function renderResult(index) {
  const result = results[index];
  const { schedule, freeSlots, credits } = result;

  // Alert
  const alertArea = document.getElementById('result-alert-area');
  alertArea.innerHTML = `
    <div class="alert alert-success">
      <span class="alert-icon">ğŸ‰</span>
      <span>ì‹œê°„í‘œê°€ ì™„ì„±ë˜ì—ˆì–´ìš”! ì´ <strong>${credits}í•™ì </strong>ì…ë‹ˆë‹¤.</span>
    </div>
  `;

  // Tags
  const tagsArea = document.getElementById('result-tags');
  const tags = [];
  for (const [setId, courseName] of Object.entries(result.selections)) {
    const set = SETS.find(s => s.id === setId);
    const course = set.courses.find(c => c.name === courseName);
    tags.push(`<span class="result-tag tag-course">${course.displayName} (${course.credits}í•™ì )</span>`);
  }
  if (freeSlots.length > 0) {
    freeSlots.forEach(slot => {
      const day = {ì›”:'ì›”',í™”:'í™”',ìˆ˜:'ìˆ˜',ëª©:'ëª©',ê¸ˆ:'ê¸ˆ'}[slot.charAt(0)];
      tags.push(`<span class="result-tag tag-free">ê³µê°•: ${day} ${slot.substring(1)}êµì‹œ</span>`);
    });
  }
  tags.push(`<span class="result-tag tag-credit">í•©ê³„ ${credits}í•™ì </span>`);
  tagsArea.innerHTML = `<div class="result-detail">${tags.join('')}</div>`;

  // Timetable
  const display = document.getElementById('timetable-display');
  let html = '<table class="timetable"><thead><tr><th>êµì‹œ</th>';
  DAYS.forEach(d => { html += `<th>${d}</th>`; });
  html += '</tr></thead><tbody>';

  PERIODS.forEach(period => {
    // Skip 9-10 for days other than ìˆ˜
    if (period === '9-10') {
      html += '<tr>';
      html += `<td class="period-cell">${period}</td>`;
      DAYS.forEach(day => {
        const key = day + period;
        const cell = schedule[key];
        if (cell) {
          const cls = cell.type === 'special' ? 'cell-special' : 'cell-fixed';
          html += `<td class="${cls}">${getCellName(cell)}</td>`;
        } else {
          html += '<td style="color:var(--gray-300)">â€”</td>';
        }
      });
      html += '</tr>';
      return;
    }

    if (period === '5-6') {
      html += '<tr class="lunch-row">';
      html += '<td>ì ì‹¬</td>';
      DAYS.forEach(() => { html += '<td>ğŸ±</td>'; });
      html += '</tr>';
    }

    html += '<tr>';
    html += `<td class="period-cell">${period}</td>`;

    DAYS.forEach(day => {
      const key = day + period;
      const cell = schedule[key];

      if (cell) {
        let cls = '';
        switch (cell.type) {
          case 'selected': cls = 'cell-selected'; break;
          case 'sport': cls = 'cell-sport'; break;
          case 'free': cls = 'cell-free'; break;
          case 'special': cls = 'cell-special'; break;
          case 'fixed': cls = 'cell-fixed'; break;
          default: cls = '';
        }
        html += `<td class="${cls}">${getCellName(cell)}</td>`;
      } else {
        html += '<td class="cell-free">ê³µê°•</td>';
      }
    });

    html += '</tr>';
  });

  html += '</tbody></table>';
  display.innerHTML = html;

  // Nav
  const nav = document.getElementById('result-nav');
  nav.innerHTML = '';
}

// ============================================================
// SAVE AS IMAGE
// ============================================================

function saveAsImage() {
  const btn = document.getElementById('save-btn');
  btn.disabled = true;
  btn.textContent = 'ì €ì¥ ì¤‘...';

  const target = document.querySelector('.timetable-container');
  html2canvas(target, {
    scale: 2,
    backgroundColor: '#ffffff',
    useCORS: true,
  }).then(canvas => {
    const link = document.createElement('a');
    link.download = 'ì´ìš°í•™êµ_ê³ 3_ì‹œê°„í‘œ.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
    btn.disabled = false;
    btn.textContent = 'ğŸ“· ì‹œê°„í‘œ ì´ë¯¸ì§€ë¡œ ì €ì¥';
  }).catch(() => {
    alert('ì´ë¯¸ì§€ ì €ì¥ì— ì‹¤íŒ¨í–ˆì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
    btn.disabled = false;
    btn.textContent = 'ğŸ“· ì‹œê°„í‘œ ì´ë¯¸ì§€ë¡œ ì €ì¥';
  });
}

// ============================================================
// INIT
// ============================================================

renderSetContainers();
updateUI();
</script>

</body>
</html>
